# TDengine


- [GitHub](https://github.com/wgong/TDengine)
- [Home](https://tdengine.com/)
- [Docs](https://docs.tdengine.com/cloud/)
- [Tutorial](https://tdengine.com/tutorials/)

## Setup locally
```
cd ~/projects/wgong/DB
# clone
git clone git@github.com:wgong/TDengine.git

# install build tool
sudo apt update -y
sudo apt install -y build-essential cmake git libjansson-dev liblzma-dev libsnappy-dev zlib1g-dev pkg-config

# build
cd TDengine
sudo apt install autoconf
cmake .. -DJEMALLOC_ENABLED=true

./build.sh


# install
sudo make install

# To start the service after installation, in a terminal, use:
sudo systemctl start taosd

# Then users can use the TDengine CLI to connect the TDengine server (default user: root taosdata, port=port=6030). In a terminal, use:
taos


# It is easy to run SQL commands from TDengine CLI which is the same as other SQL databases.

taos> CREATE DATABASE demo;
taos> USE demo;
taos> CREATE TABLE t (ts TIMESTAMP, speed INT);
taos> INSERT INTO t VALUES('2019-07-15 00:00:00', 10);
taos> INSERT INTO t VALUES('2019-07-15 01:00:00', 20);
taos> SELECT * FROM t;
          ts          |   speed   |
===================================
 19-07-15 00:00:00.000|         10|
 19-07-15 01:00:00.000|         20|
Query OK, 2 row(s) in set (0.001700s)


taos> show database;
taos> select * from demo.t;
```


## TDengine python client
```
pip3 install -U taospy

pip3 install -U taospy[ws]

# example-1
cd ./examples/python
python read_example.py

# example-2
cd ./examples/python/PYTHONConnectorChecker
python PythonChecker.py

# example-3
cd ./examples/python/taosdemo
python taosdemo.py

```


## TDengine cloud
https://cloud.tdengine.com/createFirstInstance

- register with gmail
- create org=duckai
- starter price plan: $820/month
- AWS us-east-1 cloud
- instance = duck_iot

### Instance-URL-Token
TDengine cloud provides a unique URL for each instance and uses tokens to authenticate the access. The token is generated by TDengine cloud for each user and for each instance. The token has a duration and can be reset by the user for each instance at any time for security purpose.

see .env file

### python client - `daospy`

see `daospy_demo.ipynb`


```
from taosrest import TaosRestCursor
# create STable
cursor: TaosRestCursor = conn.cursor()
cursor.execute("DROP DATABASE IF EXISTS power")
cursor.execute("CREATE DATABASE power")
cursor.execute("CREATE STABLE power.meters (ts TIMESTAMP, current FLOAT, voltage INT, phase FLOAT) TAGS (location BINARY(64), groupId INT)")

# insert data
cursor.execute("""INSERT INTO power.d1001 USING power.meters TAGS(California.SanFrancisco, 2) VALUES ('2018-10-03 14:38:05.000', 10.30000, 219, 0.31000) ('2018-10-03 14:38:15.000', 12.60000, 218, 0.33000) ('2018-10-03 14:38:16.800', 12.30000, 221, 0.31000)
    power.d1002 USING power.meters TAGS(California.SanFrancisco, 3) VALUES ('2018-10-03 14:38:16.650', 10.30000, 218, 0.25000)
    power.d1003 USING power.meters TAGS(California.LosAngeles, 2) VALUES ('2018-10-03 14:38:05.500', 11.80000, 221, 0.28000) ('2018-10-03 14:38:16.600', 13.40000, 223, 0.29000)
    power.d1004 USING power.meters TAGS(California.LosAngeles, 3) VALUES ('2018-10-03 14:38:05.000', 10.80000, 223, 0.29000) ('2018-10-03 14:38:06.500', 11.50000, 221, 0.35000)""")
print("inserted row count:", cursor.rowcount)

# query data
cursor.execute("SELECT * FROM power.meters LIMIT 3")
# get total rows
print("queried row count:", cursor.rowcount)
# get column names from cursor
column_names = [meta[0] for meta in cursor.description]
# get rows
data: list[tuple] = cursor.fetchall()
print(column_names)
for row in data:
    print(row)

# output:
# inserted row count: 8
# queried row count: 3
# ['ts', 'current', 'voltage', 'phase', 'location', 'groupid']
# [datetime.datetime(2018, 10, 3, 14, 38, 5, 500000, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), '+08:00')), 11.8, 221, 0.28, 'california.losangeles', 2]
# [datetime.datetime(2018, 10, 3, 14, 38, 16, 600000, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), '+08:00')), 13.4, 223, 0.29, 'california.losangeles', 2]
# [datetime.datetime(2018, 10, 3, 14, 38, 5, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), '+08:00')), 10.8, 223, 0.29, 'california.losangeles', 3]
```

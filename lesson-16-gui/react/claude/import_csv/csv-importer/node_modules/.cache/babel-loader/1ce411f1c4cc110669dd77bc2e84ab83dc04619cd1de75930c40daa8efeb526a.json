{"ast":null,"code":"var _jsxFileName = \"/home/gongai/projects/wgong/py4kids/lesson-16-gui/react/claude/import_csv/csv-importer/src/components/UploadCSV.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BASE_URL = process.env.REACT_APP_API_BASE_URL;\nfunction UploadCSV({\n  datasetName,\n  onDatasetNameChange,\n  onCreateDataset,\n  onUploadCSV\n}) {\n  _s();\n  const [selectedFiles, setSelectedFiles] = useState(null);\n  const [error, setError] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const handleFileChange = event => {\n    setError('');\n    setSelectedFiles(event.target.files);\n  };\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!(datasetName !== null && datasetName !== void 0 && datasetName.trim())) {\n      setError('Please enter a dataset name first');\n      return;\n    }\n    if (!(selectedFiles !== null && selectedFiles !== void 0 && selectedFiles.length)) {\n      setError('Please select files to upload');\n      return;\n    }\n    setUploading(true);\n    setError('');\n    const formData = new FormData();\n    for (let i = 0; i < selectedFiles.length; i++) {\n      formData.append('files', selectedFiles[i]);\n    }\n    try {\n      const response = await axios.post(`${BASE_URL}/api/upload-csv/${datasetName}`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n\n      // Log the response to debug\n      console.log('Upload response:', response.data);\n\n      // Validate and transform the response data\n      const uploadedFiles = response.data.map(file => {\n        var _file$sample_data;\n        return {\n          filename: file.filename,\n          table_name: file.table_name || file.filename.replace('.csv', '').toLowerCase(),\n          column_mapping: Object.fromEntries(Object.keys(((_file$sample_data = file.sample_data) === null || _file$sample_data === void 0 ? void 0 : _file$sample_data[0]) || {}).map(col => [col, col.toLowerCase().replace(/\\s+/g, '_')])),\n          sample_data: file.sample_data || []\n        };\n      });\n      console.log('Transformed upload data:', uploadedFiles);\n      onUploadCSV(uploadedFiles);\n\n      // Clear the file input\n      setSelectedFiles(null);\n      event.target.reset();\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error('Error uploading CSV:', err);\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.detail) || 'Error uploading files. Please try again.');\n    } finally {\n      setUploading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"mb-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"1. Upload CSV\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"form-label\",\n        children: \"Dataset Name:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        placeholder: \"Enter dataset name\",\n        value: datasetName,\n        onChange: e => onDatasetNameChange(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-secondary mb-3\",\n      onClick: onCreateDataset,\n      disabled: !(datasetName !== null && datasetName !== void 0 && datasetName.trim()),\n      children: \"Create Dataset\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-3\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          className: \"form-control\",\n          multiple: true,\n          accept: \".csv\",\n          onChange: handleFileChange,\n          disabled: !(datasetName !== null && datasetName !== void 0 && datasetName.trim())\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-primary\",\n        disabled: !(selectedFiles !== null && selectedFiles !== void 0 && selectedFiles.length) || uploading,\n        children: uploading ? 'Uploading...' : 'Upload'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"alert alert-danger mt-3\",\n        role: \"alert\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), selectedFiles && selectedFiles.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Selected Files:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"list-group\",\n        children: Array.from(selectedFiles).map((file, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n          className: \"list-group-item\",\n          children: file.name\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 80,\n    columnNumber: 5\n  }, this);\n}\n_s(UploadCSV, \"h5SVy0vt+EWixBg5/s/hCC9yvCw=\");\n_c = UploadCSV;\nexport default UploadCSV;\nvar _c;\n$RefreshReg$(_c, \"UploadCSV\");","map":{"version":3,"names":["React","useState","axios","jsxDEV","_jsxDEV","BASE_URL","process","env","REACT_APP_API_BASE_URL","UploadCSV","datasetName","onDatasetNameChange","onCreateDataset","onUploadCSV","_s","selectedFiles","setSelectedFiles","error","setError","uploading","setUploading","handleFileChange","event","target","files","handleSubmit","preventDefault","trim","length","formData","FormData","i","append","response","post","headers","console","log","data","uploadedFiles","map","file","_file$sample_data","filename","table_name","replace","toLowerCase","column_mapping","Object","fromEntries","keys","sample_data","col","reset","err","_err$response","_err$response$data","detail","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","value","onChange","e","onClick","disabled","onSubmit","multiple","accept","role","Array","from","index","name","_c","$RefreshReg$"],"sources":["/home/gongai/projects/wgong/py4kids/lesson-16-gui/react/claude/import_csv/csv-importer/src/components/UploadCSV.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport axios from 'axios';\n\nconst BASE_URL = process.env.REACT_APP_API_BASE_URL;\n\nfunction UploadCSV({ datasetName, onDatasetNameChange, onCreateDataset, onUploadCSV }) {\n  const [selectedFiles, setSelectedFiles] = useState(null);\n  const [error, setError] = useState('');\n  const [uploading, setUploading] = useState(false);\n\n  const handleFileChange = (event) => {\n    setError('');\n    setSelectedFiles(event.target.files);\n  };\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n    \n    if (!datasetName?.trim()) {\n      setError('Please enter a dataset name first');\n      return;\n    }\n\n    if (!selectedFiles?.length) {\n      setError('Please select files to upload');\n      return;\n    }\n\n    setUploading(true);\n    setError('');\n\n    const formData = new FormData();\n    for (let i = 0; i < selectedFiles.length; i++) {\n      formData.append('files', selectedFiles[i]);\n    }\n\n    try {\n      const response = await axios.post(\n        `${BASE_URL}/api/upload-csv/${datasetName}`,\n        formData,\n        {\n          headers: {\n            'Content-Type': 'multipart/form-data',\n          },\n        }\n      );\n\n      // Log the response to debug\n      console.log('Upload response:', response.data);\n\n      // Validate and transform the response data\n      const uploadedFiles = response.data.map(file => ({\n        filename: file.filename,\n        table_name: file.table_name || file.filename.replace('.csv', '').toLowerCase(),\n        column_mapping: Object.fromEntries(\n          Object.keys(file.sample_data?.[0] || {}).map(col => [\n            col,\n            col.toLowerCase().replace(/\\s+/g, '_')\n          ])\n        ),\n        sample_data: file.sample_data || []\n      }));\n\n      console.log('Transformed upload data:', uploadedFiles);\n      onUploadCSV(uploadedFiles);\n      \n      // Clear the file input\n      setSelectedFiles(null);\n      event.target.reset();\n\n    } catch (err) {\n      console.error('Error uploading CSV:', err);\n      setError(err.response?.data?.detail || 'Error uploading files. Please try again.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"mb-4\">\n      <h2>1. Upload CSV</h2>\n      \n      <div className=\"mb-3\">\n        <label className=\"form-label\">Dataset Name:</label>\n        <input\n          type=\"text\"\n          className=\"form-control\"\n          placeholder=\"Enter dataset name\"\n          value={datasetName}\n          onChange={(e) => onDatasetNameChange(e.target.value)}\n        />\n      </div>\n\n      <button \n        className=\"btn btn-secondary mb-3\"\n        onClick={onCreateDataset}\n        disabled={!datasetName?.trim()}\n      >\n        Create Dataset\n      </button>\n\n      <form onSubmit={handleSubmit} className=\"mt-3\">\n        <div className=\"mb-3\">\n          <input \n            type=\"file\" \n            className=\"form-control\" \n            multiple \n            accept=\".csv\" \n            onChange={handleFileChange}\n            disabled={!datasetName?.trim()}\n          />\n        </div>\n        \n        <button \n          type=\"submit\" \n          className=\"btn btn-primary\"\n          disabled={!selectedFiles?.length || uploading}\n        >\n          {uploading ? 'Uploading...' : 'Upload'}\n        </button>\n\n        {error && (\n          <div className=\"alert alert-danger mt-3\" role=\"alert\">\n            {error}\n          </div>\n        )}\n      </form>\n\n      {selectedFiles && selectedFiles.length > 0 && (\n        <div className=\"mt-3\">\n          <h4>Selected Files:</h4>\n          <ul className=\"list-group\">\n            {Array.from(selectedFiles).map((file, index) => (\n              <li key={index} className=\"list-group-item\">\n                {file.name}\n              </li>\n            ))}\n          </ul>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default UploadCSV;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,QAAQ,OAAO;AACvC,OAAOC,KAAK,MAAM,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1B,MAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB;AAEnD,SAASC,SAASA,CAAC;EAAEC,WAAW;EAAEC,mBAAmB;EAAEC,eAAe;EAAEC;AAAY,CAAC,EAAE;EAAAC,EAAA;EACrF,MAAM,CAACC,aAAa,EAAEC,gBAAgB,CAAC,GAAGf,QAAQ,CAAC,IAAI,CAAC;EACxD,MAAM,CAACgB,KAAK,EAAEC,QAAQ,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACkB,SAAS,EAAEC,YAAY,CAAC,GAAGnB,QAAQ,CAAC,KAAK,CAAC;EAEjD,MAAMoB,gBAAgB,GAAIC,KAAK,IAAK;IAClCJ,QAAQ,CAAC,EAAE,CAAC;IACZF,gBAAgB,CAACM,KAAK,CAACC,MAAM,CAACC,KAAK,CAAC;EACtC,CAAC;EAED,MAAMC,YAAY,GAAG,MAAOH,KAAK,IAAK;IACpCA,KAAK,CAACI,cAAc,CAAC,CAAC;IAEtB,IAAI,EAAChB,WAAW,aAAXA,WAAW,eAAXA,WAAW,CAAEiB,IAAI,CAAC,CAAC,GAAE;MACxBT,QAAQ,CAAC,mCAAmC,CAAC;MAC7C;IACF;IAEA,IAAI,EAACH,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEa,MAAM,GAAE;MAC1BV,QAAQ,CAAC,+BAA+B,CAAC;MACzC;IACF;IAEAE,YAAY,CAAC,IAAI,CAAC;IAClBF,QAAQ,CAAC,EAAE,CAAC;IAEZ,MAAMW,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;IAC/B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGhB,aAAa,CAACa,MAAM,EAAEG,CAAC,EAAE,EAAE;MAC7CF,QAAQ,CAACG,MAAM,CAAC,OAAO,EAAEjB,aAAa,CAACgB,CAAC,CAAC,CAAC;IAC5C;IAEA,IAAI;MACF,MAAME,QAAQ,GAAG,MAAM/B,KAAK,CAACgC,IAAI,CAC/B,GAAG7B,QAAQ,mBAAmBK,WAAW,EAAE,EAC3CmB,QAAQ,EACR;QACEM,OAAO,EAAE;UACP,cAAc,EAAE;QAClB;MACF,CACF,CAAC;;MAED;MACAC,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEJ,QAAQ,CAACK,IAAI,CAAC;;MAE9C;MACA,MAAMC,aAAa,GAAGN,QAAQ,CAACK,IAAI,CAACE,GAAG,CAACC,IAAI;QAAA,IAAAC,iBAAA;QAAA,OAAK;UAC/CC,QAAQ,EAAEF,IAAI,CAACE,QAAQ;UACvBC,UAAU,EAAEH,IAAI,CAACG,UAAU,IAAIH,IAAI,CAACE,QAAQ,CAACE,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAACC,WAAW,CAAC,CAAC;UAC9EC,cAAc,EAAEC,MAAM,CAACC,WAAW,CAChCD,MAAM,CAACE,IAAI,CAAC,EAAAR,iBAAA,GAAAD,IAAI,CAACU,WAAW,cAAAT,iBAAA,uBAAhBA,iBAAA,CAAmB,CAAC,CAAC,KAAI,CAAC,CAAC,CAAC,CAACF,GAAG,CAACY,GAAG,IAAI,CAClDA,GAAG,EACHA,GAAG,CAACN,WAAW,CAAC,CAAC,CAACD,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CACvC,CACH,CAAC;UACDM,WAAW,EAAEV,IAAI,CAACU,WAAW,IAAI;QACnC,CAAC;MAAA,CAAC,CAAC;MAEHf,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEE,aAAa,CAAC;MACtD1B,WAAW,CAAC0B,aAAa,CAAC;;MAE1B;MACAvB,gBAAgB,CAAC,IAAI,CAAC;MACtBM,KAAK,CAACC,MAAM,CAAC8B,KAAK,CAAC,CAAC;IAEtB,CAAC,CAAC,OAAOC,GAAG,EAAE;MAAA,IAAAC,aAAA,EAAAC,kBAAA;MACZpB,OAAO,CAACnB,KAAK,CAAC,sBAAsB,EAAEqC,GAAG,CAAC;MAC1CpC,QAAQ,CAAC,EAAAqC,aAAA,GAAAD,GAAG,CAACrB,QAAQ,cAAAsB,aAAA,wBAAAC,kBAAA,GAAZD,aAAA,CAAcjB,IAAI,cAAAkB,kBAAA,uBAAlBA,kBAAA,CAAoBC,MAAM,KAAI,0CAA0C,CAAC;IACpF,CAAC,SAAS;MACRrC,YAAY,CAAC,KAAK,CAAC;IACrB;EACF,CAAC;EAED,oBACEhB,OAAA;IAAKsD,SAAS,EAAC,MAAM;IAAAC,QAAA,gBACnBvD,OAAA;MAAAuD,QAAA,EAAI;IAAa;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eAEtB3D,OAAA;MAAKsD,SAAS,EAAC,MAAM;MAAAC,QAAA,gBACnBvD,OAAA;QAAOsD,SAAS,EAAC,YAAY;QAAAC,QAAA,EAAC;MAAa;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAO,CAAC,eACnD3D,OAAA;QACE4D,IAAI,EAAC,MAAM;QACXN,SAAS,EAAC,cAAc;QACxBO,WAAW,EAAC,oBAAoB;QAChCC,KAAK,EAAExD,WAAY;QACnByD,QAAQ,EAAGC,CAAC,IAAKzD,mBAAmB,CAACyD,CAAC,CAAC7C,MAAM,CAAC2C,KAAK;MAAE;QAAAN,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACtD,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,eAEN3D,OAAA;MACEsD,SAAS,EAAC,wBAAwB;MAClCW,OAAO,EAAEzD,eAAgB;MACzB0D,QAAQ,EAAE,EAAC5D,WAAW,aAAXA,WAAW,eAAXA,WAAW,CAAEiB,IAAI,CAAC,CAAC,CAAC;MAAAgC,QAAA,EAChC;IAED;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAQ,CAAC,eAET3D,OAAA;MAAMmE,QAAQ,EAAE9C,YAAa;MAACiC,SAAS,EAAC,MAAM;MAAAC,QAAA,gBAC5CvD,OAAA;QAAKsD,SAAS,EAAC,MAAM;QAAAC,QAAA,eACnBvD,OAAA;UACE4D,IAAI,EAAC,MAAM;UACXN,SAAS,EAAC,cAAc;UACxBc,QAAQ;UACRC,MAAM,EAAC,MAAM;UACbN,QAAQ,EAAE9C,gBAAiB;UAC3BiD,QAAQ,EAAE,EAAC5D,WAAW,aAAXA,WAAW,eAAXA,WAAW,CAAEiB,IAAI,CAAC,CAAC;QAAC;UAAAiC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAChC;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACC,CAAC,eAEN3D,OAAA;QACE4D,IAAI,EAAC,QAAQ;QACbN,SAAS,EAAC,iBAAiB;QAC3BY,QAAQ,EAAE,EAACvD,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEa,MAAM,KAAIT,SAAU;QAAAwC,QAAA,EAE7CxC,SAAS,GAAG,cAAc,GAAG;MAAQ;QAAAyC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAChC,CAAC,EAER9C,KAAK,iBACJb,OAAA;QAAKsD,SAAS,EAAC,yBAAyB;QAACgB,IAAI,EAAC,OAAO;QAAAf,QAAA,EAClD1C;MAAK;QAAA2C,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACG,CAAC,EAENhD,aAAa,IAAIA,aAAa,CAACa,MAAM,GAAG,CAAC,iBACxCxB,OAAA;MAAKsD,SAAS,EAAC,MAAM;MAAAC,QAAA,gBACnBvD,OAAA;QAAAuD,QAAA,EAAI;MAAe;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eACxB3D,OAAA;QAAIsD,SAAS,EAAC,YAAY;QAAAC,QAAA,EACvBgB,KAAK,CAACC,IAAI,CAAC7D,aAAa,CAAC,CAACyB,GAAG,CAAC,CAACC,IAAI,EAAEoC,KAAK,kBACzCzE,OAAA;UAAgBsD,SAAS,EAAC,iBAAiB;UAAAC,QAAA,EACxClB,IAAI,CAACqC;QAAI,GADHD,KAAK;UAAAjB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAEV,CACL;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACA,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACF,CACN;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACE,CAAC;AAEV;AAACjD,EAAA,CAzIQL,SAAS;AAAAsE,EAAA,GAATtE,SAAS;AA2IlB,eAAeA,SAAS;AAAC,IAAAsE,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}